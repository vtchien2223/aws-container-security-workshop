<!doctype html><html lang=en class="js csstransforms3d"><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.148.2"><meta name=description content="Hướng dẫn triển khai ứng dụng an toàn"><meta name=author content="Tên của bạn"><link rel=icon href=/aws-container-security-workshop/images/favicon.png type=image/png><title>2.2 Xây dựng Pipeline :: Tài Liệu Của Tôi</title><link href=/aws-container-security-workshop/css/nucleus.css?1754764310 rel=stylesheet><link href=/aws-container-security-workshop/css/fontawesome-all.min.css?1754764310 rel=stylesheet><link href=/aws-container-security-workshop/css/hybrid.css?1754764310 rel=stylesheet><link href=/aws-container-security-workshop/css/featherlight.min.css?1754764310 rel=stylesheet><link href=/aws-container-security-workshop/css/perfect-scrollbar.min.css?1754764310 rel=stylesheet><link href=/aws-container-security-workshop/css/auto-complete.css?1754764310 rel=stylesheet><link href=/aws-container-security-workshop/css/atom-one-dark-reasonable.css?1754764310 rel=stylesheet><link href=/aws-container-security-workshop/css/theme.css?1754764310 rel=stylesheet><link href=/aws-container-security-workshop/css/tabs.css?1754764310 rel=stylesheet><link href=/aws-container-security-workshop/css/hugo-theme.css?1754764310 rel=stylesheet><link href=/aws-container-security-workshop/css/theme-aws.css?1754764310 rel=stylesheet><link href=/aws-container-security-workshop/css/custom.css?1754764310 rel=stylesheet><script src=/aws-container-security-workshop/js/jquery-3.3.1.min.js?1754764310></script><style>:root #header+#content>#left>#rlblock_left{display:none !important}</style></head><body data-url=/aws-container-security-workshop/xay-dung-pipeline/codepipeline/><nav id=sidebar class=showVisitedLinks><div id=header-wrapper><div id=header><a id=logo href=/aws-container-security-workshop/><img src=/aws-container-security-workshop/images/logo-aws.png alt="Tài Liệu Của Tôi"></a></div><div class=searchbox><label for=search-by><i class="fas fa-search"></i></label>
<input data-search-input id=search-by type=search placeholder=Search...>
<span data-search-clear><i class="fas fa-times"></i></span></div><script type=text/javascript src=/aws-container-security-workshop/js/lunr.min.js?1754764310></script><script type=text/javascript src=/aws-container-security-workshop/js/auto-complete.js?1754764310></script><script type=text/javascript>var baseurl="https://vtchien2223.github.io/aws-container-security-workshop/"</script><script type=text/javascript src=/aws-container-security-workshop/js/search.js?1754764310></script></div><section id=homelinks><ul><li><a class=padding href=/><i class='fas fa-home'></i> Home</a></li></ul></section><div class=highlightable><ul class=topics><li data-nav-id=/aws-container-security-workshop/chuan-bi/ title="1.Chuẩn bị" class=dd-item><a href=/aws-container-security-workshop/chuan-bi/>1.Chuẩn bị
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/aws-container-security-workshop/chuan-bi/chuan-bi-ung-dung/ title="1.1 Chuẩn bị Mã nguồn" class=dd-item><a href=/aws-container-security-workshop/chuan-bi/chuan-bi-ung-dung/>1.1 Chuẩn bị Mã nguồn
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/aws-container-security-workshop/chuan-bi/giai-thich-ma-nguon/ title="1.2 Giải Thích Mã nguồn" class=dd-item><a href=/aws-container-security-workshop/chuan-bi/giai-thich-ma-nguon/>1.2 Giải Thích Mã nguồn
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/aws-container-security-workshop/chuan-bi/vpc-sg/ title="1.3 Chuẩn bị Mạng (VPC & Security Group)" class=dd-item><a href=/aws-container-security-workshop/chuan-bi/vpc-sg/>1.3 Chuẩn bị Mạng (VPC & Security Group)
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/aws-container-security-workshop/xay-dung-pipeline/ title="2.Xây dựng Pipeline CI & Quét an ninh" class="dd-item
parent"><a href=/aws-container-security-workshop/xay-dung-pipeline/>2.Xây dựng Pipeline CI & Quét an ninh
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/aws-container-security-workshop/xay-dung-pipeline/ecr/ title="2.1 Tạo ECR Repository" class=dd-item><a href=/aws-container-security-workshop/xay-dung-pipeline/ecr/>2.1 Tạo ECR Repository
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/aws-container-security-workshop/xay-dung-pipeline/codepipeline/ title="2.2 Xây dựng Pipeline" class="dd-item
active"><a href=/aws-container-security-workshop/xay-dung-pipeline/codepipeline/>2.2 Xây dựng Pipeline
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/aws-container-security-workshop/xay-dung-pipeline/securitycheck/ title="2.3 Tạo Cổng An ninh" class=dd-item><a href=/aws-container-security-workshop/xay-dung-pipeline/securitycheck/>2.3 Tạo Cổng An ninh
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/aws-container-security-workshop/trien-khai-ung-dung/ title="3.Triển khai ứng dụng" class=dd-item><a href=/aws-container-security-workshop/trien-khai-ung-dung/>3.Triển khai ứng dụng
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/aws-container-security-workshop/trien-khai-ung-dung/ecs-cluster/ title="3.1 Tạo ECS Cluster" class=dd-item><a href=/aws-container-security-workshop/trien-khai-ung-dung/ecs-cluster/>3.1 Tạo ECS Cluster
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/aws-container-security-workshop/trien-khai-ung-dung/task-definition/ title="3.2 Tạo Task Definition" class=dd-item><a href=/aws-container-security-workshop/trien-khai-ung-dung/task-definition/>3.2 Tạo Task Definition
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/aws-container-security-workshop/trien-khai-ung-dung/ecs-service/ title="3.3 Tạo ECS Service & Chạy ứng dụng" class=dd-item><a href=/aws-container-security-workshop/trien-khai-ung-dung/ecs-service/>3.3 Tạo ECS Service & Chạy ứng dụng
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/aws-container-security-workshop/giam-sat-khac-phuc/ title="4.Giám sát & Tự động Khắc phục" class=dd-item><a href=/aws-container-security-workshop/giam-sat-khac-phuc/>4.Giám sát & Tự động Khắc phục
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/aws-container-security-workshop/giam-sat-khac-phuc/monitoring/ title="4.1 Giám sát An ninh & Tuân thủ" class=dd-item><a href=/aws-container-security-workshop/giam-sat-khac-phuc/monitoring/>4.1 Giám sát An ninh & Tuân thủ
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/aws-container-security-workshop/giam-sat-khac-phuc/remediation/ title="4.2 Tự động Khắc phục sự cố" class=dd-item><a href=/aws-container-security-workshop/giam-sat-khac-phuc/remediation/>4.2 Tự động Khắc phục sự cố
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/aws-container-security-workshop/don-dep/ title="5.Dọn dẹp Tài nguyên" class=dd-item><a href=/aws-container-security-workshop/don-dep/>5.Dọn dẹp Tài nguyên
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/aws-container-security-workshop/chi-phi/ title="Phụ lục: Ước tính Chi phí" class=dd-item><a href=/aws-container-security-workshop/chi-phi/>Phụ lục: Ước tính Chi phí
<i class="fas fa-check read-icon"></i></a></li></ul><section id=prefooter><hr><ul><li><a class=padding href=# data-clear-history-toggle><i class="fas fa-history fa-fw"></i> Clear History</a></li></ul></section><section id=footer><div class=custom-footer-container><ul class=custom-footer-links><li><a href=https://awsstudygroup.com/blog/ target=_blank><i class="fab fa-aws"></i> AWS Study Group - Blog</a></li><li><a href=https://www.facebook.com/groups/awsstudygroupfcj/ target=_blank><i class="fab fa-facebook-square"></i> AWS Study Group - Nhóm FB</a></li></ul><div class=custom-footer-info><p><strong>Last Updated</strong><br>10-08-2025</p><p><strong>Team</strong><br><span>Gia Hưng</span><br><span>Hoàng Kha</span><br></p></div></div></section></div></nav><section id=body><div id=overlay></div><div class="padding highlightable"><div><div id=top-bar><div id=breadcrumbs itemscope itemtype=http://data-vocabulary.org/Breadcrumb><span id=sidebar-toggle-span><a href=# id=sidebar-toggle data-sidebar-toggle><i class="fas fa-bars"></i>
</a></span><span id=toc-menu><i class="fas fa-list-alt"></i></span>
<span class=links><a href=/aws-container-security-workshop/>Giới thiệu Workshop</a> > <a href=/aws-container-security-workshop/xay-dung-pipeline/>2.Xây dựng Pipeline CI & Quét an ninh</a> > 2.2 Xây dựng Pipeline</span></div><div class=progress><div class=wrapper><nav id=TableOfContents><ul><li><ul><li><a href=#a-tạo-pipeline-và-stage-source>A. Tạo Pipeline và Stage &ldquo;Source&rdquo;</a></li><li><a href=#b-tạo-stage-build>B. Tạo Stage &ldquo;Build&rdquo;</a></li><li><a href=#c-cấp-quyền-iam-bước-bắt-buộc>C. Cấp quyền IAM (Bước bắt buộc)</a></li></ul></li></ul></nav></div></div></div></div><div id=head-tags></div><div id=body-inner><h1>2.2 Xây dựng Pipeline</h1><p>Trong phần này, chúng ta sẽ tạo ra &ldquo;bộ não&rdquo; của hệ thống: một <strong>AWS CodePipeline</strong> hoàn chỉnh. Chúng ta sẽ xây dựng thủ công thay vì dùng template để kiểm soát mọi chi tiết. Pipeline này sẽ tự động lấy mã nguồn, build image và đẩy lên ECR.</p><h3 id=a-tạo-pipeline-và-stage-source>A. Tạo Pipeline và Stage &ldquo;Source&rdquo;</h3><ol><li><p>Truy cập dịch vụ <strong>AWS CodePipeline</strong> và nhấn <strong>Create pipeline</strong>.</p></li><li><p><strong>Pipeline settings</strong>:</p><ul><li><strong>Pipeline name</strong>: <code>Security-Pipeline</code>.</li><li><strong>Service role</strong>: Chọn <code>New service role</code>.<div class="notices info"><pre><code>Lựa chọn này sẽ tự động tạo một IAM Role cho pipeline (ví dụ: `AWSCodePipelineServiceRole-...-Security-Pipeline`). Chúng ta sẽ cần cấp thêm quyền cho role này ở các bước sau.
</code></pre></div></li></ul></li><li><p><strong>Source stage</strong>:</p><ul><li><strong>Source provider</strong>: Chọn <code>GitHub (Version 2)</code>.</li><li><strong>Connection</strong>: Kết nối đến tài khoản GitHub của bạn.</li></ul><h4 id=hướng-dẫn-kết-nối-tới-github>Hướng dẫn kết nối tới GitHub</h4><div class="notices tip"><pre><code>Nếu đây là lần đầu bạn kết nối, hãy làm theo các bước sau.
</code></pre></div><ol><li>Nhấn vào nút <strong>Connect to GitHub</strong>.</li><li>Một cửa sổ pop-up sẽ hiện ra. Đặt tên cho kết nối (ví dụ: <code>my-github-connection</code>) và nhấn <strong>Connect to GitHub</strong>.</li><li>Bạn sẽ được chuyển đến trang GitHub để xác thực. Hãy đăng nhập và cấp quyền (Authorize) cho <strong>AWS Connector for GitHub</strong>.</li><li>Tiếp theo, bạn sẽ cài đặt ứng dụng AWS. Ở phần <strong>Repository access</strong>, bạn có thể chọn <code>All repositories</code> hoặc <code>Only select repositories</code> (và chỉ chọn repo của workshop).</li><li>Sau khi cài đặt, cửa sổ pop-up sẽ tự đóng và kết nối của bạn sẽ được chọn trong CodePipeline.</li></ol><ul><li><strong>Repository name</strong>: Chọn repository của bạn (<code>my-container-security-app</code>).</li><li><strong>Branch</strong>: <code>main</code>.
<img src=/images/source-stage.png alt></li></ul></li><li><p>Nhấn <strong>Next</strong>.</p></li></ol><h3 id=b-tạo-stage-build>B. Tạo Stage &ldquo;Build&rdquo;</h3><ol><li>Trên màn hình &ldquo;Add build stage&rdquo;.</li><li><strong>Cấu hình build:</strong><ul><li><strong>Action provider</strong>: <code>Other build provider</code> - > <code>AWS CodeBuild</code>.</li><li><strong>Input artifacts</strong>: Chọn <code>SourceOutput</code> (đây là sản phẩm từ stage Source).</li></ul></li><li><strong>Tạo CodeBuild Project:</strong><ul><li>Nhấn vào nút <strong>Create project</strong>. Một cửa sổ mới sẽ hiện ra.</li><li><strong>Project name</strong>: <code>CodeBuild-Project</code>.</li><li><strong>Environment</strong>: Giữ nguyên các lựa chọn mặc định (Managed image, Amazon Linux, Standard&mldr;).</li><li><strong>Privileged</strong>: Mở rộng Additional configuration -> tick chọn Privileged
<img src=/images/privileged.png alt><div class="notices warning"><strong>BẮT BUỘC</strong> phải tick chọn ô này để CodeBuild có quyền build Docker image.</div></li><li><strong>Service role</strong>: <code>New service role</code>.</li><li><strong>Environment variables (Quan trọng)</strong>: Cuộn xuống và thêm chính xác 3 biến sau. Đây là bước cực kỳ quan trọng để <code>buildspec.yml</code> có thể hoạt động.<ul><li><strong>Name</strong>: <code>IMAGE_REPO_NAME</code>, <strong>Value</strong>: <code>my-portfolio-app</code> (tên ECR repo bạn đã tạo ở bước 2.1).</li><li><strong>Name</strong>: <code>AWS_ACCOUNT_ID</code>, <strong>Value</strong>: [ID tài khoản AWS của bạn, ví dụ: 12345678].</li><li><strong>Name</strong>: <code>AWS_DEFAULT_REGION</code>, <strong>Value</strong>: [Region bạn đang sử dụng, ví dụ: ap-southeast-1].
<img src=/images/enviroment.png alt></li></ul></li><li><strong>Buildspecs</strong>: Chọn Use a buildspec file.</li><li>Nhấn <strong>Continue to CodePipeline</strong>.</li></ul></li><li>Nhấn <strong>Next</strong>.</li><li>Nhấn <strong>Skip Test stage and Deploy stage</strong>.</li><li>Nhấn <strong>Create Pipeline</strong>.</li></ol><h3 id=c-cấp-quyền-iam-bước-bắt-buộc>C. Cấp quyền IAM (Bước bắt buộc)</h3><div class="notices warning"><p>Pipeline vừa tạo sẽ thất bại ở lần chạy đầu tiên vì các IAM role mới được tạo tự động không có đủ quyền. Chúng ta sẽ cấp quyền cho chúng ngay bây giờ để pipeline hoạt động đúng.</p></div><ol><li>Truy cập dịch vụ <strong>IAM</strong> -> <strong>Roles</strong>.</li><li><strong>Cấp quyền cho CodeBuild Role:</strong><ul><li>Tìm role có tên chứa <code>CodeBuild-Project</code>.</li><li>Đính kèm policy: <strong><code>AmazonEC2ContainerRegistryPowerUser</code></strong>. Policy này cho phép CodeBuild đăng nhập và đẩy image lên ECR.</li></ul></li><li><strong>Cấp quyền cho CodePipeline Role:</strong><ul><li>Tìm role có tên chứa <code>Security-Pipeline</code>.</li><li>Đính kèm policy: <strong><code>AWSCodeBuildDeveloperAccess</code></strong>. Policy này cho phép CodePipeline ra lệnh khởi động các job trong CodeBuild.</li></ul></li></ol><p>Sau khi cấp quyền, bạn có thể vào lại pipeline và nhấn &ldquo;Release change&rdquo; để bắt đầu một lượt build thành công.</p><footer class=footline></footer></div></div><div id=navigation><a class="nav nav-prev" href=/aws-container-security-workshop/xay-dung-pipeline/ecr/ title="2.1 Tạo ECR Repository"><i class="fa fa-chevron-left"></i></a>
<a class="nav nav-next" href=/aws-container-security-workshop/xay-dung-pipeline/securitycheck/ title="2.3 Tạo Cổng An ninh" style=margin-right:0><i class="fa fa-chevron-right"></i></a></div></section><div style=left:-1000px;overflow:scroll;position:absolute;top:-1000px;border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px><div style=border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px></div></div><script src=/aws-container-security-workshop/js/clipboard.min.js?1754764310></script><script src=/aws-container-security-workshop/js/perfect-scrollbar.min.js?1754764310></script><script src=/aws-container-security-workshop/js/perfect-scrollbar.jquery.min.js?1754764310></script><script src=/aws-container-security-workshop/js/jquery.sticky.js?1754764310></script><script src=/aws-container-security-workshop/js/featherlight.min.js?1754764310></script><script src=/aws-container-security-workshop/js/highlight.pack.js?1754764310></script><script>hljs.initHighlightingOnLoad()</script><script src=/aws-container-security-workshop/js/modernizr.custom-3.6.0.js?1754764310></script><script src=/aws-container-security-workshop/js/learn.js?1754764310></script><script src=/aws-container-security-workshop/js/hugo-learn.js?1754764310></script><script src=/aws-container-security-workshop/mermaid/mermaid.js?1754764310></script><script>mermaid.initialize({startOnLoad:!0})</script></body></html>