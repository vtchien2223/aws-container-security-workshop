<!doctype html><html lang=en class="js csstransforms3d"><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.148.2"><meta name=description content="Hướng dẫn triển khai ứng dụng an toàn"><meta name=author content="Tên của bạn"><link rel=icon href=/aws-container-security-workshop/images/favicon.png type=image/png><title>2.3 Tạo Cổng An ninh :: Tài Liệu Của Tôi</title><link href=/aws-container-security-workshop/css/nucleus.css?1754764678 rel=stylesheet><link href=/aws-container-security-workshop/css/fontawesome-all.min.css?1754764678 rel=stylesheet><link href=/aws-container-security-workshop/css/hybrid.css?1754764678 rel=stylesheet><link href=/aws-container-security-workshop/css/featherlight.min.css?1754764678 rel=stylesheet><link href=/aws-container-security-workshop/css/perfect-scrollbar.min.css?1754764678 rel=stylesheet><link href=/aws-container-security-workshop/css/auto-complete.css?1754764678 rel=stylesheet><link href=/aws-container-security-workshop/css/atom-one-dark-reasonable.css?1754764678 rel=stylesheet><link href=/aws-container-security-workshop/css/theme.css?1754764678 rel=stylesheet><link href=/aws-container-security-workshop/css/tabs.css?1754764678 rel=stylesheet><link href=/aws-container-security-workshop/css/hugo-theme.css?1754764678 rel=stylesheet><link href=/aws-container-security-workshop/css/theme-aws.css?1754764678 rel=stylesheet><link href=/aws-container-security-workshop/css/custom.css?1754764678 rel=stylesheet><script src=/aws-container-security-workshop/js/jquery-3.3.1.min.js?1754764678></script><style>:root #header+#content>#left>#rlblock_left{display:none !important}</style></head><body data-url=/aws-container-security-workshop/xay-dung-pipeline/securitycheck/><nav id=sidebar class=showVisitedLinks><div id=header-wrapper><div id=header><a id=logo href=/aws-container-security-workshop/><img src=/aws-container-security-workshop/images/logo-aws.png alt="Tài Liệu Của Tôi"></a></div><div class=searchbox><label for=search-by><i class="fas fa-search"></i></label>
<input data-search-input id=search-by type=search placeholder=Search...>
<span data-search-clear><i class="fas fa-times"></i></span></div><script type=text/javascript src=/aws-container-security-workshop/js/lunr.min.js?1754764678></script><script type=text/javascript src=/aws-container-security-workshop/js/auto-complete.js?1754764678></script><script type=text/javascript>var baseurl="https://vtchien2223.github.io/aws-container-security-workshop/"</script><script type=text/javascript src=/aws-container-security-workshop/js/search.js?1754764678></script></div><section id=homelinks><ul><li><a class=padding href=https://vtchien2223.github.io/><i class='fas fa-home'></i> Home</a></li></ul></section><div class=highlightable><ul class=topics><li data-nav-id=/aws-container-security-workshop/chuan-bi/ title="1.Chuẩn bị" class=dd-item><a href=/aws-container-security-workshop/chuan-bi/>1.Chuẩn bị
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/aws-container-security-workshop/chuan-bi/chuan-bi-ung-dung/ title="1.1 Chuẩn bị Mã nguồn" class=dd-item><a href=/aws-container-security-workshop/chuan-bi/chuan-bi-ung-dung/>1.1 Chuẩn bị Mã nguồn
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/aws-container-security-workshop/chuan-bi/giai-thich-ma-nguon/ title="1.2 Giải Thích Mã nguồn" class=dd-item><a href=/aws-container-security-workshop/chuan-bi/giai-thich-ma-nguon/>1.2 Giải Thích Mã nguồn
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/aws-container-security-workshop/chuan-bi/vpc-sg/ title="1.3 Chuẩn bị Mạng (VPC & Security Group)" class=dd-item><a href=/aws-container-security-workshop/chuan-bi/vpc-sg/>1.3 Chuẩn bị Mạng (VPC & Security Group)
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/aws-container-security-workshop/xay-dung-pipeline/ title="2.Xây dựng Pipeline CI & Quét an ninh" class="dd-item
parent"><a href=/aws-container-security-workshop/xay-dung-pipeline/>2.Xây dựng Pipeline CI & Quét an ninh
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/aws-container-security-workshop/xay-dung-pipeline/ecr/ title="2.1 Tạo ECR Repository" class=dd-item><a href=/aws-container-security-workshop/xay-dung-pipeline/ecr/>2.1 Tạo ECR Repository
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/aws-container-security-workshop/xay-dung-pipeline/codepipeline/ title="2.2 Xây dựng Pipeline" class=dd-item><a href=/aws-container-security-workshop/xay-dung-pipeline/codepipeline/>2.2 Xây dựng Pipeline
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/aws-container-security-workshop/xay-dung-pipeline/securitycheck/ title="2.3 Tạo Cổng An ninh" class="dd-item
active"><a href=/aws-container-security-workshop/xay-dung-pipeline/securitycheck/>2.3 Tạo Cổng An ninh
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/aws-container-security-workshop/trien-khai-ung-dung/ title="3.Triển khai ứng dụng" class=dd-item><a href=/aws-container-security-workshop/trien-khai-ung-dung/>3.Triển khai ứng dụng
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/aws-container-security-workshop/trien-khai-ung-dung/ecs-cluster/ title="3.1 Tạo ECS Cluster" class=dd-item><a href=/aws-container-security-workshop/trien-khai-ung-dung/ecs-cluster/>3.1 Tạo ECS Cluster
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/aws-container-security-workshop/trien-khai-ung-dung/task-definition/ title="3.2 Tạo Task Definition" class=dd-item><a href=/aws-container-security-workshop/trien-khai-ung-dung/task-definition/>3.2 Tạo Task Definition
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/aws-container-security-workshop/trien-khai-ung-dung/ecs-service/ title="3.3 Tạo ECS Service & Chạy ứng dụng" class=dd-item><a href=/aws-container-security-workshop/trien-khai-ung-dung/ecs-service/>3.3 Tạo ECS Service & Chạy ứng dụng
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/aws-container-security-workshop/giam-sat-khac-phuc/ title="4.Giám sát & Tự động Khắc phục" class=dd-item><a href=/aws-container-security-workshop/giam-sat-khac-phuc/>4.Giám sát & Tự động Khắc phục
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/aws-container-security-workshop/giam-sat-khac-phuc/monitoring/ title="4.1 Giám sát An ninh & Tuân thủ" class=dd-item><a href=/aws-container-security-workshop/giam-sat-khac-phuc/monitoring/>4.1 Giám sát An ninh & Tuân thủ
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/aws-container-security-workshop/giam-sat-khac-phuc/remediation/ title="4.2 Tự động Khắc phục sự cố" class=dd-item><a href=/aws-container-security-workshop/giam-sat-khac-phuc/remediation/>4.2 Tự động Khắc phục sự cố
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/aws-container-security-workshop/don-dep/ title="5.Dọn dẹp Tài nguyên" class=dd-item><a href=/aws-container-security-workshop/don-dep/>5.Dọn dẹp Tài nguyên
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/aws-container-security-workshop/chi-phi/ title="Phụ lục: Ước tính Chi phí" class=dd-item><a href=/aws-container-security-workshop/chi-phi/>Phụ lục: Ước tính Chi phí
<i class="fas fa-check read-icon"></i></a></li></ul><section id=prefooter><hr><ul><li><a class=padding href=# data-clear-history-toggle><i class="fas fa-history fa-fw"></i> Clear History</a></li></ul></section><section id=footer><div class=custom-footer-container><ul class=custom-footer-links><li><a href=https://awsstudygroup.com/blog/ target=_blank><i class="fab fa-aws"></i> AWS Study Group - Blog</a></li><li><a href=https://www.facebook.com/groups/awsstudygroupfcj/ target=_blank><i class="fab fa-facebook-square"></i> AWS Study Group - Nhóm FB</a></li></ul><div class=custom-footer-info><p><strong>Last Updated</strong><br>10-08-2025</p><p><strong>Team</strong><br><span>Gia Hưng</span><br><span>Hoàng Kha</span><br></p></div></div></section></div></nav><section id=body><div id=overlay></div><div class="padding highlightable"><div><div id=top-bar><div id=breadcrumbs itemscope itemtype=http://data-vocabulary.org/Breadcrumb><span id=sidebar-toggle-span><a href=# id=sidebar-toggle data-sidebar-toggle><i class="fas fa-bars"></i>
</a></span><span id=toc-menu><i class="fas fa-list-alt"></i></span>
<span class=links><a href=/aws-container-security-workshop/>Giới thiệu Workshop</a> > <a href=/aws-container-security-workshop/xay-dung-pipeline/>2.Xây dựng Pipeline CI & Quét an ninh</a> > 2.3 Tạo Cổng An ninh</span></div><div class=progress><div class=wrapper><nav id=TableOfContents><ul><li><ul><li><a href=#a-tạo-iam-role-cho-lambda>A. Tạo IAM Role cho Lambda</a></li><li><a href=#b-tạo-lambda-function>B. Tạo Lambda Function</a></li><li><a href=#c-thêm-stage-security_check-vào-pipeline>C. Thêm Stage &ldquo;Security_Check&rdquo; vào Pipeline</a></li><li><a href=#d-cấp-quyền-cuối-cùng-cho-pipeline>D. Cấp quyền cuối cùng cho Pipeline</a></li></ul></li></ul></nav></div></div></div></div><div id=head-tags></div><div id=body-inner><h1>2.3 Tạo Cổng An ninh</h1><p>Bây giờ pipeline đã có thể tự động build image, chúng ta sẽ tạo một &ldquo;cổng kiểm soát an ninh&rdquo; bằng AWS Lambda. Nếu image có lỗ hổng nghiêm trọng, pipeline sẽ tự động dừng lại, ngăn chặn việc triển khai các ứng dụng có rủi ro.</p><h3 id=a-tạo-iam-role-cho-lambda>A. Tạo IAM Role cho Lambda</h3><div class="notices info"><p>Hàm Lambda cần có quyền để đọc kết quả quét từ Amazon Inspector và báo cáo trạng thái (thành công/thất bại) về cho CodePipeline.</p></div><ol><li>Truy cập dịch vụ <strong>IAM</strong> -> <strong>Roles</strong> -> <strong>Create role</strong>.</li><li><strong>Trusted entity</strong>: <code>AWS service</code>, <strong>Use case</strong>: <code>Lambda</code>.</li><li><strong>Add permissions</strong>: Tìm và đính kèm 2 policy sau:<ul><li><code>AmazonInspector2ReadOnlyAccess</code></li><li><code>AWSCodePipeline_FullAccess</code></li></ul></li><li><strong>Role name</strong>: Đặt tên là <code>VulnerabilityCheckLambdaRole</code> và hoàn tất việc tạo role.</li></ol><h3 id=b-tạo-lambda-function>B. Tạo Lambda Function</h3><ol><li>Truy cập dịch vụ <strong>AWS Lambda</strong> -> <strong>Create function</strong>.</li><li><strong>Function name</strong>: <code>VulnerabilityCheckFunction</code>.</li><li><strong>Runtime</strong>: Chọn <code>Python 3.11</code> (hoặc mới hơn).</li><li><strong>Permissions</strong>: Chọn <code>Use an existing role</code> và chọn role <code>VulnerabilityCheckLambdaRole</code> bạn vừa tạo.
<img src=/images/cr-lamda.png alt></li><li><strong>Thêm Code:</strong> Sao chép và dán toàn bộ đoạn code Python sau vào trình soạn thảo code của Lambda.<div class="notices tip"><pre><code>Đoạn code này sẽ nhận artifact từ pipeline, tìm ra image vừa được build, sau đó gọi Amazon Inspector để kiểm tra các lỗ hổng có mức độ `CRITICAL` hoặc `HIGH`.
</code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> boto3
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> json
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> logging
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> zipfile
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> os
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>logger <span style=color:#f92672>=</span> logging<span style=color:#f92672>.</span>getLogger()
</span></span><span style=display:flex><span>logger<span style=color:#f92672>.</span>setLevel(logging<span style=color:#f92672>.</span>INFO)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>inspector_client <span style=color:#f92672>=</span> boto3<span style=color:#f92672>.</span>client(<span style=color:#e6db74>&#39;inspector2&#39;</span>)
</span></span><span style=display:flex><span>codepipeline_client <span style=color:#f92672>=</span> boto3<span style=color:#f92672>.</span>client(<span style=color:#e6db74>&#39;codepipeline&#39;</span>)
</span></span><span style=display:flex><span>s3_client <span style=color:#f92672>=</span> boto3<span style=color:#f92672>.</span>client(<span style=color:#e6db74>&#39;s3&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>get_image_details_from_artifact</span>(job_data):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>try</span>:
</span></span><span style=display:flex><span>        artifact_data <span style=color:#f92672>=</span> job_data[<span style=color:#e6db74>&#39;inputArtifacts&#39;</span>][<span style=color:#ae81ff>0</span>]
</span></span><span style=display:flex><span>        s3_location <span style=color:#f92672>=</span> artifact_data[<span style=color:#e6db74>&#39;location&#39;</span>][<span style=color:#e6db74>&#39;s3Location&#39;</span>]
</span></span><span style=display:flex><span>        bucket_name <span style=color:#f92672>=</span> s3_location[<span style=color:#e6db74>&#39;bucketName&#39;</span>]
</span></span><span style=display:flex><span>        object_key <span style=color:#f92672>=</span> s3_location[<span style=color:#e6db74>&#39;objectKey&#39;</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        local_zip_path <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;/tmp/artifact.zip&#34;</span>
</span></span><span style=display:flex><span>        s3_client<span style=color:#f92672>.</span>download_file(bucket_name, object_key, local_zip_path)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        extract_dir <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;/tmp/artifact_extracted&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>with</span> zipfile<span style=color:#f92672>.</span>ZipFile(local_zip_path, <span style=color:#e6db74>&#39;r&#39;</span>) <span style=color:#66d9ef>as</span> zip_ref:
</span></span><span style=display:flex><span>            zip_ref<span style=color:#f92672>.</span>extractall(extract_dir)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        imagedefinitions_path <span style=color:#f92672>=</span> os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>join(extract_dir, <span style=color:#e6db74>&#39;imagedefinitions.json&#39;</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>with</span> open(imagedefinitions_path, <span style=color:#e6db74>&#39;r&#39;</span>) <span style=color:#66d9ef>as</span> f:
</span></span><span style=display:flex><span>            imagedefs <span style=color:#f92672>=</span> json<span style=color:#f92672>.</span>load(f)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        image_uri <span style=color:#f92672>=</span> imagedefs[<span style=color:#ae81ff>0</span>][<span style=color:#e6db74>&#39;imageUri&#39;</span>]
</span></span><span style=display:flex><span>        repo_name <span style=color:#f92672>=</span> image_uri<span style=color:#f92672>.</span>split(<span style=color:#e6db74>&#39;@&#39;</span>)[<span style=color:#ae81ff>0</span>]<span style=color:#f92672>.</span>split(<span style=color:#e6db74>&#39;/&#39;</span>, <span style=color:#ae81ff>1</span>)[<span style=color:#ae81ff>1</span>]
</span></span><span style=display:flex><span>        image_digest <span style=color:#f92672>=</span> image_uri<span style=color:#f92672>.</span>split(<span style=color:#e6db74>&#39;@&#39;</span>)[<span style=color:#ae81ff>1</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> repo_name, image_digest
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>except</span> <span style=color:#a6e22e>Exception</span> <span style=color:#66d9ef>as</span> e:
</span></span><span style=display:flex><span>        logger<span style=color:#f92672>.</span>error(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Failed to get image details from artifact: </span><span style=color:#e6db74>{</span>str(e)<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>raise</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>lambda_handler</span>(event, context):
</span></span><span style=display:flex><span>    job_id <span style=color:#f92672>=</span> event[<span style=color:#e6db74>&#39;CodePipeline.job&#39;</span>][<span style=color:#e6db74>&#39;id&#39;</span>]
</span></span><span style=display:flex><span>    job_data <span style=color:#f92672>=</span> event[<span style=color:#e6db74>&#39;CodePipeline.job&#39;</span>][<span style=color:#e6db74>&#39;data&#39;</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>try</span>:
</span></span><span style=display:flex><span>        repo_name, image_digest <span style=color:#f92672>=</span> get_image_details_from_artifact(job_data)
</span></span><span style=display:flex><span>        logger<span style=color:#f92672>.</span>info(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Checking vulnerabilities for image </span><span style=color:#e6db74>{</span>repo_name<span style=color:#e6db74>}</span><span style=color:#e6db74> with digest </span><span style=color:#e6db74>{</span>image_digest<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        paginator <span style=color:#f92672>=</span> inspector_client<span style=color:#f92672>.</span>get_paginator(<span style=color:#e6db74>&#39;list_findings&#39;</span>)
</span></span><span style=display:flex><span>        pages <span style=color:#f92672>=</span> paginator<span style=color:#f92672>.</span>paginate(
</span></span><span style=display:flex><span>            filterCriteria<span style=color:#f92672>=</span>{
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#39;awsAccountId&#39;</span>: [{<span style=color:#e6db74>&#39;comparison&#39;</span>: <span style=color:#e6db74>&#39;EQUALS&#39;</span>, <span style=color:#e6db74>&#39;value&#39;</span>: context<span style=color:#f92672>.</span>invoked_function_arn<span style=color:#f92672>.</span>split(<span style=color:#e6db74>&#34;:&#34;</span>)[<span style=color:#ae81ff>4</span>]}],
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#39;ecrImageDigest&#39;</span>: [{<span style=color:#e6db74>&#39;comparison&#39;</span>: <span style=color:#e6db74>&#39;EQUALS&#39;</span>, <span style=color:#e6db74>&#39;value&#39;</span>: image_digest}]
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        critical_or_high_findings <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> page <span style=color:#f92672>in</span> pages:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>for</span> finding <span style=color:#f92672>in</span> page<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#39;findings&#39;</span>, []):
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> finding<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#39;severity&#39;</span>) <span style=color:#f92672>in</span> [<span style=color:#e6db74>&#39;CRITICAL&#39;</span>, <span style=color:#e6db74>&#39;HIGH&#39;</span>]:
</span></span><span style=display:flex><span>                    logger<span style=color:#f92672>.</span>warning(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Found </span><span style=color:#e6db74>{</span>finding<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#39;severity&#39;</span>)<span style=color:#e6db74>}</span><span style=color:#e6db74> finding: </span><span style=color:#e6db74>{</span>finding<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#39;type&#39;</span>)<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>                    critical_or_high_findings<span style=color:#f92672>.</span>append(finding)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> critical_or_high_findings:
</span></span><span style=display:flex><span>            failure_message <span style=color:#f92672>=</span> <span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Pipeline stopped. Found </span><span style=color:#e6db74>{</span>len(critical_or_high_findings)<span style=color:#e6db74>}</span><span style=color:#e6db74> CRITICAL/HIGH severity vulnerabilities.&#34;</span>
</span></span><span style=display:flex><span>            logger<span style=color:#f92672>.</span>error(failure_message)
</span></span><span style=display:flex><span>            codepipeline_client<span style=color:#f92672>.</span>put_job_failure_result(
</span></span><span style=display:flex><span>                jobId<span style=color:#f92672>=</span>job_id,
</span></span><span style=display:flex><span>                failureDetails<span style=color:#f92672>=</span>{<span style=color:#e6db74>&#39;type&#39;</span>: <span style=color:#e6db74>&#39;JobFailed&#39;</span>, <span style=color:#e6db74>&#39;message&#39;</span>: failure_message}
</span></span><span style=display:flex><span>            )
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>            success_message <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Security scan passed. No CRITICAL/HIGH severity vulnerabilities found.&#34;</span>
</span></span><span style=display:flex><span>            logger<span style=color:#f92672>.</span>info(success_message)
</span></span><span style=display:flex><span>            codepipeline_client<span style=color:#f92672>.</span>put_job_success_result(jobId<span style=color:#f92672>=</span>job_id)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>except</span> <span style=color:#a6e22e>Exception</span> <span style=color:#66d9ef>as</span> e:
</span></span><span style=display:flex><span>        logger<span style=color:#f92672>.</span>error(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;An error occurred: </span><span style=color:#e6db74>{</span>str(e)<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>        codepipeline_client<span style=color:#f92672>.</span>put_job_failure_result(
</span></span><span style=display:flex><span>            jobId<span style=color:#f92672>=</span>job_id,
</span></span><span style=display:flex><span>            failureDetails<span style=color:#f92672>=</span>{<span style=color:#e6db74>&#39;type&#39;</span>: <span style=color:#e6db74>&#39;JobFailed&#39;</span>, <span style=color:#e6db74>&#39;message&#39;</span>: <span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Function error: </span><span style=color:#e6db74>{</span>str(e)<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>}
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#39;Done&#39;</span>
</span></span></code></pre></div><img src=/images/deploy-lamda.png alt></li><li>Nhấn <strong>Deploy</strong>. Sau đó, vào tab <strong>Configuration</strong> -> <strong>General configuration</strong> và tăng <strong>Timeout</strong> lên <strong>1 phút</strong>.</li></ol><h3 id=c-thêm-stage-security_check-vào-pipeline>C. Thêm Stage &ldquo;Security_Check&rdquo; vào Pipeline</h3><ol><li>Quay lại pipeline <code>Security-Pipeline</code> và nhấn <strong>Edit</strong>.</li><li>Sau stage <code>Build</code>, nhấn <strong>+ Add stage</strong> và đặt tên là <code>Security_Check</code>.
<img src=/images/stagte_securitycheck.png alt></li><li>Trong stage mới, <strong>Add action group</strong>.</li><li><strong>Cấu hình Action:</strong><ul><li><strong>Action name</strong>: <code>Check_Vulnerabilities</code>.</li><li><strong>Action provider</strong>: <code>AWS Lambda</code>.</li><li><strong>Input artifacts</strong>: Chọn <code>BuildArtifact</code>.</li><li><strong>Function name</strong>: Chọn <code>VulnerabilityCheckFunction</code>.
<img src=/images/add-action.png alt></li></ul></li><li><strong>Save</strong> lại pipeline.</li></ol><h3 id=d-cấp-quyền-cuối-cùng-cho-pipeline>D. Cấp quyền cuối cùng cho Pipeline</h3><div class="notices warning"><p>Đây là bước cuối cùng để hoàn thiện chuỗi quyền hạn. Đừng bỏ qua nó!</p></div><ol><li>Truy cập <strong>IAM</strong> -> <strong>Roles</strong>.</li><li>Tìm <strong>CodePipeline Service Role</strong> (tên chứa <code>Security-Pipeline</code>).</li><li>Đính kèm thêm policy: <strong><code>AWSLambda_FullAccess</code></strong>.</li></ol><p>Sau khi hoàn thành, hãy nhấn <strong>&ldquo;Release change&rdquo;</strong> trên pipeline để chạy và kiểm tra toàn bộ quy trình.
<img src=/images/securitypipeline.png alt></p><footer class=footline></footer></div></div><div id=navigation><a class="nav nav-prev" href=/aws-container-security-workshop/xay-dung-pipeline/codepipeline/ title="2.2 Xây dựng Pipeline"><i class="fa fa-chevron-left"></i></a>
<a class="nav nav-next" href=/aws-container-security-workshop/trien-khai-ung-dung/ title="3.Triển khai ứng dụng" style=margin-right:0><i class="fa fa-chevron-right"></i></a></div></section><div style=left:-1000px;overflow:scroll;position:absolute;top:-1000px;border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px><div style=border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px></div></div><script src=/aws-container-security-workshop/js/clipboard.min.js?1754764678></script><script src=/aws-container-security-workshop/js/perfect-scrollbar.min.js?1754764678></script><script src=/aws-container-security-workshop/js/perfect-scrollbar.jquery.min.js?1754764678></script><script src=/aws-container-security-workshop/js/jquery.sticky.js?1754764678></script><script src=/aws-container-security-workshop/js/featherlight.min.js?1754764678></script><script src=/aws-container-security-workshop/js/highlight.pack.js?1754764678></script><script>hljs.initHighlightingOnLoad()</script><script src=/aws-container-security-workshop/js/modernizr.custom-3.6.0.js?1754764678></script><script src=/aws-container-security-workshop/js/learn.js?1754764678></script><script src=/aws-container-security-workshop/js/hugo-learn.js?1754764678></script><script src=/aws-container-security-workshop/mermaid/mermaid.js?1754764678></script><script>mermaid.initialize({startOnLoad:!0})</script></body></html>